# ⚡ 瞬間英作文フラッシュカード — 仕様書

## 概要

ブラウザ上で動作するオフライン対応の英語トレーニングアプリ。日本語を見て瞬時に英作文する練習を、フラッシュカード形式で行う。PWA対応によりiPhoneのホーム画面からアプリとして利用可能。

---

## 技術スタック

| 項目 | 技術 |
|------|------|
| フロントエンド | Vanilla HTML / CSS / JavaScript（フレームワーク不使用） |
| データ保存 | IndexedDB（ブラウザローカル） |
| 音声再生 | Web Speech API (SpeechSynthesis) |
| ルーティング | ハッシュベース SPA ルーター |
| PWA | Service Worker + manifest.json |
| フォント | Google Fonts (Inter) |

---

## ファイル構成

```
EngCard/
├── index.html           … エントリポイント（PWAメタタグ・SW登録）
├── manifest.json        … PWA マニフェスト
├── sw.js                … Service Worker（キャッシュ戦略）
├── css/
│   └── style.css        … デザインシステム（ダーク/ライト対応）
├── js/
│   ├── db.js            … IndexedDB CRUD・エクスポート/インポート
│   ├── speech.js        … 音声再生・音声選択・速度調整
│   ├── cards.js         … カード作成・編集・削除・お気に入り
│   ├── quiz.js          … クイズ（ジャンル選択→出題→結果）
│   └── app.js           … SPAルーター・テーマ管理・各種一覧画面
├── icons/
│   └── icon.svg         … アプリアイコン（SVG）
└── data/
    └── cards_updated.json … サンプルカードデータ
```

---

## 画面一覧

### 1. トップ画面 (`#top`)
- タイトル表示
- 統計バー（クリック可能）
  - **カード数** → カード一覧へ遷移
  - **ジャンル数** → ジャンル選択へ遷移
  - **累計ミス** → ミスが多いカード一覧へ遷移
- メニュー
  - ✏️ カード作成モード
  - 📖 問題に答えるモード
  - ⭐ お気に入り
  - ⚙️ 設定

### 2. カード作成画面 (`#cards`)
- **入力フォーム**
  - 日本語（必須）
  - 英語（必須）
  - ジャンル（必須・カンマ区切りで複数可・既存ジャンルを候補表示）
  - メモ（任意・覚えるためのコツなど）
- **エクスポート/インポート** — JSON形式でデータの書き出し・読み込み
- **カード一覧**
  - 日本語・英語・メモプレビュー・ジャンルタグ（複数対応）
  - ☆/★ お気に入りトグル（ワンタップ切替）
  - ✏️ 編集ボタン → モーダルで編集（全フィールド変更可）
  - 🗑️ 削除ボタン（確認ダイアログ付き）

### 3. クイズ画面

#### 3a. ジャンル選択 (`#quiz`)
- ⭐ お気に入り（お気に入りカードがある場合のみ表示）
- 各ジャンルカード（カード枚数表示）

#### 3b. 出題画面 (`#quiz-question`)
- 日本語のみ表示（英語は非表示）
- **3段階の表示フロー**
  1. 初期状態：日本語のみ
  2. 「🧩 穴埋めを見る」→ 英語の穴埋めヒント表示（任意ステップ）
  3. 「👁️ 正解を見る」→ 英語全文表示 → 正誤判定ボタン
- **正解表示後に利用可能**
  - ⭕ 正解 / ❌ 不正解 — 正誤判定（二重クリック防止あり）
  - ☆/★ お気に入りトグル
  - ✏️ 編集 — モーダルで即編集（セッション継続）
  - メモがある場合は自動表示
- **常時利用可能**
  - 🔊 音声を聞く — 英語を読み上げ
  - 📝 メモを見る（メモがある場合のみ・正解表示前）
  - 📊 結果を見る / ジャンル選択 / トップ

#### 3c. 結果画面 (`#quiz-result`)
- 出題数・正解数・不正解数・正答率
- 成績に応じた絵文字とメッセージ
- 不正解カード一覧（コピー機能付き）
- 「同じジャンルでもう一度」ボタン

### 4. お気に入り一覧 (`#favorites`)
- お気に入りカードの一覧表示
- ★ お気に入り解除・✏️ 編集
- 「📖 お気に入りで問題を解く」ボタン

### 5. ミスが多いカード一覧 (`#miss-list`)
- ミス回数順に並べ替え表示
- ミス回数バッジ・ジャンルタグ

### 6. 設定画面 (`#settings`)
- **音声選択** — デバイスの英語音声一覧からドロップダウンで選択
- **速度調整** — 0.5〜1.5倍速スライダー
- テスト再生ボタン
- 設定はlocalStorageに自動保存

---

## データモデル

### Card（IndexedDB `cards` ストア）

| フィールド | 型 | 説明 |
|------------|------|------|
| `id` | string | UUID（主キー） |
| `japanese` | string | 日本語テキスト |
| `english` | string | 英語テキスト |
| `genre` | string | ジャンル（カンマ区切りで複数可） |
| `memo` | string | メモ（任意） |
| `favorite` | boolean | お気に入りフラグ |
| `wrongCount` | number | 不正解回数（重み付けに使用） |
| `lastAnswered` | string\|null | 最終回答日時（ISO 8601） |

---

## 主要ロジック

### 出題アルゴリズム（重み付きランダム）
```
weight = 1 + wrongCount × 2
```
不正解回数が多いカードほど出題確率が高くなる。

### 穴埋め生成
- 英語文を単語に分割
- 3文字以上の単語からランダムに1つ選択
- 選択された単語をアンダースコアに置換
- 問題ごとにキャッシュし、再描画時に変更されない

### ジャンル複数対応
- カンマ（`,`）または読点（`、`）で分割
- 1枚のカードが複数ジャンルに所属可能
- 各ジャンルの出題時にフィルタリング

---

## テーマ

| 項目 | ダークモード | ライトモード |
|------|------------|------------|
| 背景 | `#0f0f1a` | `#f0f2f5` |
| カード | `#1a1a2e` | `#ffffff` |
| テキスト | `#e8e6f0` | `#1a1a2e` |
| 切替 | 右上の ☀️/🌙 ボタン | localStorageに保存 |

---

## PWA対応

- **Service Worker**: キャッシュファースト戦略。全アセットをインストール時にキャッシュ
- **manifest.json**: スタンドアロン表示、ポートレート固定
- **iOS対応**: `apple-mobile-web-app-capable`、safe-area対応
- **オフライン**: インストール後は完全オフラインで動作

---

## デプロイ方法

1. GitHubにPrivateリポジトリを作成
2. 全ファイルをアップロード
3. Settings → Pages → Deploy from branch (`main`)
4. iPhoneのSafariでURL → 「ホーム画面に追加」
